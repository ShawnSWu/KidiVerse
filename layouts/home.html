{{ define "main" }}
  <article class="post-article">
    <div class="dashboard-content">
      <a href="{{ "about/" | relURL }}" class="galaxy-btn" id="planetAbout" title="About KidiVerse">
        <div class="galaxy-arms">
          <div class="arm arm1"></div>
          <div class="arm arm2"></div>
          <div class="arm arm3"></div>
        </div>
        <div class="galaxy-stars">
          {{ range seq 30 }}<span class="star"></span>{{ end }}
          <span class="special-star"></span>
        </div>
      </a>
      <div class="planet-overlay"></div>
      <div class="welcome-header">
        <div class="welcome-flex">
          <div class="avatar-container">
            {{ with resources.Get "astronaut-icon.png" }}
              <img src="{{ .RelPermalink }}" alt="Astronaut avatar" class="avatar-image">
            {{ end }}
          </div>
          <div class="welcome-text">
            <h1>{{ .Site.Params.welcomeMessage | default "Welcome," }} {{ .Site.Params.userName | default "Explorer" }}</h1>
            <p class="welcome-tagline">{{ .Site.Params.description | default "Explore my knowledge universe" }}</p>
          </div>
          <div class="stats-box">
            <div class="stats-item">
              <div class="stats-label">All Notes</div>
              <div class="stats-value" id="total-md-count">{{ len .Site.RegularPages }}</div>
            </div>
            <div class="stats-item">
              <div class="stats-label">Graph Nodes</div>
              <div class="stats-value" id="total-graph-count">--</div>
            </div>
          </div>
        </div>
      </div>

      <div class="knowledge-section">
        <h2>Knowledge Graph</h2>
        <div class="graph-container">
          <div class="graph-visualization">
            <svg id="knowledge-graph" width="100%" height="100%"></svg>
          </div>
        </div>
      </div>

    </div>
  </article>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const planetAbout = document.getElementById('planetAbout');
      if (planetAbout) {
        planetAbout.addEventListener('click', function(e) {
          e.preventDefault();
          document.body.classList.add('zooming-out');
          setTimeout(() => {
            window.location.href = this.href;
          }, 800);
        });
      }

      async function loadGraphData() {
        const dataPath = '{{ "data/notes_graph.json" | absURL }}';
        try {
          console.log('Loading graph data from {{ "/data/notes_graph.json" | absURL }}...');
          const response = await fetch('{{ "/data/notes_graph.json" | absURL }}');
          

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const graphData = await response.json();
          document.getElementById('total-graph-count').textContent = graphData.nodes.length;
          window.graphData = graphData;
          if (typeof initGraph === 'function') {
            initGraph();
          }
        } catch (error) {
          console.error('Error loading graph data:', error);
          document.getElementById('total-graph-count').textContent = 'Error';
        }
      }

      loadGraphData();
    });
  </script>

  <!-- D3.js Library -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

{{ end }}
