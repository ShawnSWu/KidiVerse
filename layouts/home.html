{{ define "main" }}
  <article class="post-article">
    <div class="dashboard-content">
      <a href="{{ "about/" | relURL }}" class="galaxy-btn" id="planetAbout" title="About KidiVerse">
        <div class="galaxy-arms">
          <div class="arm arm1"></div>
          <div class="arm arm2"></div>
          <div class="arm arm3"></div>
        </div>
        <div class="galaxy-stars">
          {{ range seq 30 }}<span class="star"></span>{{ end }}
          <span class="special-star"></span>
        </div>
      </a>
      <div class="planet-overlay"></div>
      <div class="welcome-header">
        <div class="welcome-flex">
          <div class="avatar-container">
            <img src="{{ "/images/astronaut-icon.png" | relURL }}" alt="Astronaut avatar" class="avatar-image">
          </div>
          <div class="welcome-text">
            <h1>{{ .Site.Params.welcomeMessage | default "Welcome," }} {{ .Site.Params.userName | default "Explorer" }}</h1>
            <p class="welcome-tagline">{{ .Site.Params.description | default "Explore my knowledge universe" }}</p>
          </div>
          <div class="stats-box">
            <div class="stats-item">
              <div class="stats-label">All Notes</div>
              <div class="stats-value" id="total-md-count">{{ len .Site.RegularPages }}</div>
            </div>
            <div class="stats-item">
              <div class="stats-label">Graph Nodes</div>
              <div class="stats-value" id="total-graph-count">--</div>
            </div>
          </div>
        </div>
      </div>

      <div class="knowledge-section">
        <h2>Knowledge Graph</h2>
        <div class="graph-container">
          <div class="graph-visualization">
            <svg id="knowledge-graph" width="100%" height="100%"></svg>
          </div>
        </div>
      </div>

    </div>
  </article>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const planetAbout = document.getElementById('planetAbout');
      if (planetAbout) {
        planetAbout.addEventListener('click', function(e) {
          e.preventDefault();
          document.body.classList.add('zooming-out');
          setTimeout(() => {
            window.location.href = this.href;
          }, 800);
        });
      }

      async function loadGraphData() {
        const dataPath = '{{ "data/notes_graph.json" | absURL }}';
        try {
          // Use the correct path for GitHub Pages - prepend the repository name
          const dataPath = '{{ "/KidiVerse/data/notes_graph.json" | absURL }}';
          console.log('Loading graph data from:', dataPath);
          
          const response = await fetch(dataPath, {
            cache: 'no-cache',
            headers: {
              'Cache-Control': 'no-cache, no-store, must-revalidate',
              'Pragma': 'no-cache',
              'Expires': '0'
            }
          });
          

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const graphData = await response.json();

          console.log('Graph data loaded successfully');
          
          // Make graph data available globally with proper structure
          window.graphData = {
            nodes: Array.isArray(graphData.nodes) ? graphData.nodes : [],
            links: Array.isArray(graphData.links) ? graphData.links : []
          };
          
          console.log('Processed graph data:', { 
            nodes: window.graphData.nodes.length,
            links: window.graphData.links.length,
            sampleNode: window.graphData.nodes[0],
            sampleLink: window.graphData.links[0]
          });
          
          // Initialize the graph after loading data

          if (typeof initGraph === 'function') {
            initGraph();
          }
        } catch (error) {
          console.error('Error loading graph data:', error);
          document.getElementById('total-graph-count').textContent = 'Error';
        }
      }

      loadGraphData();
    });
  </script>

  <!-- D3.js Library -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

{{ end }}
